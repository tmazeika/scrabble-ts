"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
function loadDictionary() {
    return __awaiter(this, void 0, void 0, function* () {
        const resp = yield fetch('/scrabble/dictionary.txt');
        const text = yield resp.text();
        return text.split('\n')
            .filter(line => line !== '')
            .map(line => [...line].map(letter => letter));
    });
}
loadDictionary().then(dict => {
    console.log(dict[5]);
});
const MAX_RACK_LEN = 7;
const BOARD_SIZE = 15;
var Dir;
(function (Dir) {
    Dir["ACROSS"] = "across";
    Dir["DOWN"] = "down";
})(Dir || (Dir = {}));
const LETTERS = {
    'A': { points: 1, count: 9 },
    'B': { points: 3, count: 2 },
    'C': { points: 3, count: 2 },
    'D': { points: 2, count: 4 },
    'E': { points: 1, count: 12 },
    'F': { points: 4, count: 2 },
    'G': { points: 2, count: 3 },
    'H': { points: 4, count: 2 },
    'I': { points: 1, count: 9 },
    'J': { points: 8, count: 1 },
    'K': { points: 5, count: 1 },
    'L': { points: 1, count: 4 },
    'M': { points: 3, count: 2 },
    'N': { points: 1, count: 6 },
    'O': { points: 1, count: 8 },
    'P': { points: 3, count: 2 },
    'Q': { points: 10, count: 1 },
    'R': { points: 1, count: 6 },
    'S': { points: 1, count: 4 },
    'T': { points: 1, count: 6 },
    'U': { points: 1, count: 4 },
    'V': { points: 4, count: 2 },
    'W': { points: 4, count: 2 },
    'X': { points: 8, count: 1 },
    'Y': { points: 4, count: 2 },
    'Z': { points: 10, count: 1 },
    '_': { points: 0, count: 2 },
};
const LETTER_KEYS = Object.keys(LETTERS);
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}
function removeFirst(arr, e) {
    const i = arr.indexOf(e);
    if (i > -1) {
        arr.splice(i, 1);
    }
    return arr;
}
function search(arr, start, endMax, leftPredicate, rightPredicate) {
    for (let i = start; i >= 0; i--) {
        if (!leftPredicate(arr[i], i)) {
            break;
        }
    }
    for (let i = start + 1; i < endMax; i++) {
        if (!rightPredicate(arr[i], i)) {
            break;
        }
    }
}
class Bag {
    constructor() {
        this.letters = shuffle(Object.entries(LETTERS)
            .reduce((bag, [letter, props]) => [...bag, ...Array(props.count).fill(letter)], Array()));
    }
    draw(n) {
        console.assert(n >= 0);
        return this.letters.splice(0, n);
    }
    get isEmpty() {
        return this.letters.length === 0;
    }
    toString() {
        return this.letters.join();
    }
}
class Tile {
    get isEmpty() {
        return this.letter === undefined;
    }
}
class Tiles {
    constructor(tiles) {
        this.tiles = (tiles !== undefined)
            ? tiles
            : Array(BOARD_SIZE)
                .fill(undefined)
                .map(() => Array(BOARD_SIZE)
                .fill(undefined)
                .map(() => new Tile()));
    }
    get transposed() {
        return new Tiles(this.tiles[0].map((_, col) => this.tiles.map(row => row[col])));
    }
    getRow(row) {
        console.assert(row >= 0);
        console.assert(row < BOARD_SIZE);
        return this.tiles[row];
    }
    getCol(col) {
        console.assert(col >= 0);
        console.assert(col < BOARD_SIZE);
        return this.tiles.map(row => row[col]);
    }
    toString() {
        let str = '  ';
        for (let i = 0; i < BOARD_SIZE; i++) {
            str += i.toString(16) + ' ';
        }
        str += '\n';
        for (let i = 0; i < BOARD_SIZE; i++) {
            const row = this.tiles[i];
            str += i.toString(16) + ' ';
            for (const tile of row) {
                str += (tile.letter || '-') + ' ';
            }
            str += '\n';
        }
        return str;
    }
}
class Board {
    constructor() {
        this.tiles = new Tiles();
    }
    place(row, col, letters, dir) {
        const tiles = (dir === Dir.DOWN) ? this.tiles.transposed : this.tiles;
        if (dir === Dir.DOWN)
            [row, col] = [col, row];
        const rowTiles = tiles.getRow(row);
        let points = 0;
        const addPointsUntilBlank = (t) => {
            if (t.isEmpty) {
                return false;
            }
            points += LETTERS[t.letter].points;
            return true;
        };
        let letterIdx = 0;
        search(rowTiles, col - 1, BOARD_SIZE, addPointsUntilBlank, (t, col) => {
            if (t.isEmpty && letterIdx === letters.length) {
                return false;
            }
            const letter = letters[letterIdx++];
            if (t.isEmpty) {
                t.letter = letter;
                search(tiles.getCol(col), row, BOARD_SIZE, addPointsUntilBlank, addPointsUntilBlank);
            }
            else {
                points += LETTERS[t.letter].points;
            }
            return true;
        });
        return points;
    }
    toString() {
        return this.tiles.toString();
    }
}
class Scrabble {
    constructor(...players) {
        this.bag = new Bag();
        this.board = new Board();
        this.players = players;
        players.forEach(player => player.drawFrom(this.bag));
    }
    toString() {
        return this.board.toString();
    }
}
class Player {
    constructor(name) {
        this.points = 0;
        this.rack = [];
        this.name = name;
    }
    drawFrom(bag) {
        this.rack.push(...bag.draw(MAX_RACK_LEN - this.rack.length));
    }
    play(game, row, col, letters, dir) {
        this.points += game.board.place(row, col, letters, dir);
        letters.forEach(letter => removeFirst(this.rack, letter));
        this.drawFrom(game.bag);
    }
    toString() {
        return `${this.name} (${this.points} points) ${this.rack.join()}`;
    }
}
const player1 = new Player('TJ');
const player2 = new Player('Justine');
const game = new Scrabble(player1, player2);
console.log(game.toString());
console.log(player1.toString());
console.log(player2.toString());
function play(player, row, col, word, dir) {
    const letters = [...word].map(letter => letter);
    player.play(game, row, col, letters, dir);
    console.log(game.toString());
    console.log(player1.toString());
    console.log(player2.toString());
}
window.play1 = function (row, col, word, dir) {
    play(player1, row, col, word, dir);
};
window.play2 = function (row, col, word, dir) {
    play(player2, row, col, word, dir);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxTQUFlLGNBQWM7O1FBQzNCLE1BQU0sSUFBSSxHQUFHLE1BQU0sS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDckQsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDL0IsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQzthQUNwQixNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEtBQUssRUFBRSxDQUFDO2FBQzNCLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFnQixDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0NBQUE7QUFFRCxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7SUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN2QixDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sWUFBWSxHQUFHLENBQUMsQ0FBQztBQUN2QixNQUFNLFVBQVUsR0FBRyxFQUFFLENBQUM7QUFFdEIsSUFBSyxHQUdKO0FBSEQsV0FBSyxHQUFHO0lBQ04sd0JBQWlCLENBQUE7SUFDakIsb0JBQWEsQ0FBQTtBQUNmLENBQUMsRUFISSxHQUFHLEtBQUgsR0FBRyxRQUdQO0FBdUNELE1BQU0sT0FBTyxHQUF3QjtJQUNuQyxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxLQUFLLEVBQUUsRUFBRSxFQUFDO0lBQzVCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRyxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztJQUMzQixHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFHLEtBQUssRUFBRSxDQUFDLEVBQUM7SUFDM0IsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFDO0lBQzNCLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUcsS0FBSyxFQUFFLENBQUMsRUFBQztDQUM1QixDQUFDO0FBRUYsTUFBTSxXQUFXLEdBQXVCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFhLENBQUM7QUFFekUsU0FBUyxPQUFPLENBQUksR0FBUTtJQUMxQixLQUFLLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDdkMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QyxDQUFDLEdBQUcsQ0FB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b250ZW50IjpbImFzeW5jIGZ1bmN0aW9uIGxvYWREaWN0aW9uYXJ5KCk6IFByb21pc2U8TGV0dGVyW11bXT4ge1xuICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goJy9zY3JhYmJsZS9kaWN0aW9uYXJ5LnR4dCcpO1xuICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcC50ZXh0KCk7XG4gIHJldHVybiB0ZXh0LnNwbGl0KCdcXG4nKVxuICAgIC5maWx0ZXIobGluZSA9PiBsaW5lICE9PSAnJylcbiAgICAubWFwKGxpbmUgPT4gWy4uLmxpbmVdLm1hcChsZXR0ZXIgPT4gbGV0dGVyIGFzIExldHRlcikpO1xufVxuXG5sb2FkRGljdGlvbmFyeSgpLnRoZW4oZGljdCA9PiB7XG4gIGNvbnNvbGUubG9nKGRpY3RbNV0pO1xufSk7XG5cbmNvbnN0IE1BWF9SQUNLX0xFTiA9IDc7XG5jb25zdCBCT0FSRF9TSVpFID0gMTU7XG5cbmVudW0gRGlyIHtcbiAgQUNST1NTID0gJ2Fjcm9zcycsXG4gIERPV04gPSAnZG93bicsXG59XG5cbmludGVyZmFjZSBMZXR0ZXJQcm9wcyB7XG4gIHBvaW50czogbnVtYmVyO1xuICBjb3VudDogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgTGV0dGVyTWFwIHtcbiAgJ0EnOiBMZXR0ZXJQcm9wcyxcbiAgJ0InOiBMZXR0ZXJQcm9wcyxcbiAgJ0MnOiBMZXR0ZXJQcm9wcyxcbiAgJ0QnOiBMZXR0ZXJQcm9wcyxcbiAgJ0UnOiBMZXR0ZXJQcm9wcyxcbiAgJ0YnOiBMZXR0ZXJQcm9wcyxcbiAgJ0cnOiBMZXR0ZXJQcm9wcyxcbiAgJ0gnOiBMZXR0ZXJQcm9wcyxcbiAgJ0knOiBMZXR0ZXJQcm9wcyxcbiAgJ0onOiBMZXR0ZXJQcm9wcyxcbiAgJ0snOiBMZXR0ZXJQcm9wcyxcbiAgJ0wnOiBMZXR0ZXJQcm9wcyxcbiAgJ00nOiBMZXR0ZXJQcm9wcyxcbiAgJ04nOiBMZXR0ZXJQcm9wcyxcbiAgJ08nOiBMZXR0ZXJQcm9wcyxcbiAgJ1AnOiBMZXR0ZXJQcm9wcyxcbiAgJ1EnOiBMZXR0ZXJQcm9wcyxcbiAgJ1InOiBMZXR0ZXJQcm9wcyxcbiAgJ1MnOiBMZXR0ZXJQcm9wcyxcbiAgJ1QnOiBMZXR0ZXJQcm9wcyxcbiAgJ1UnOiBMZXR0ZXJQcm9wcyxcbiAgJ1YnOiBMZXR0ZXJQcm9wcyxcbiAgJ1cnOiBMZXR0ZXJQcm9wcyxcbiAgJ1gnOiBMZXR0ZXJQcm9wcyxcbiAgJ1knOiBMZXR0ZXJQcm9wcyxcbiAgJ1onOiBMZXR0ZXJQcm9wcyxcbiAgJ18nOiBMZXR0ZXJQcm9wcyxcbn1cblxudHlwZSBMZXR0ZXIgPSBrZXlvZiBMZXR0ZXJNYXA7XG5cbmNvbnN0IExFVFRFUlM6IFJlYWRvbmx5PExldHRlck1hcD4gPSB7XG4gICdBJzoge3BvaW50czogMSwgIGNvdW50OiA5fSxcbiAgJ0InOiB7cG9pbnRzOiAzLCAgY291bnQ6IDJ9LFxuICAnQyc6IHtwb2ludHM6IDMsICBjb3VudDogMn0sXG4gICdEJzoge3BvaW50czogMiwgIGNvdW50OiA0fSxcbiAgJ0UnOiB7cG9pbnRzOiAxLCAgY291bnQ6IDEyfSxcbiAgJ0YnOiB7cG9pbnRzOiA0LCAgY291bnQ6IDJ9LFxuICAnRyc6IHtwb2ludHM6IDIsICBjb3VudDogM30sXG4gICdIJzoge3BvaW50czogNCwgIGNvdW50OiAyfSxcbiAgJ0knOiB7cG9pbnRzOiAxLCAgY291bnQ6IDl9LFxuICAnSic6IHtwb2ludHM6IDgsICBjb3VudDogMX0sXG4gICdLJzoge3BvaW50czogNSwgIGNvdW50OiAxfSxcbiAgJ0wnOiB7cG9pbnRzOiAxLCAgY291bnQ6IDR9LFxuICAnTSc6IHtwb2ludHM6IDMsICBjb3VudDogMn0sXG4gICdOJzoge3BvaW50czogMSwgIGNvdW50OiA2fSxcbiAgJ08nOiB7cG9pbnRzOiAxLCAgY291bnQ6IDh9LFxuICAnUCc6IHtwb2ludHM6IDMsICBjb3VudDogMn0sXG4gICdRJzoge3BvaW50czogMTAsIGNvdW50OiAxfSxcbiAgJ1InOiB7cG9pbnRzOiAxLCAgY291bnQ6IDZ9LFxuICAnUyc6IHtwb2ludHM6IDEsICBjb3VudDogNH0sXG4gICdUJzoge3BvaW50czogMSwgIGNvdW50OiA2fSxcbiAgJ1UnOiB7cG9pbnRzOiAxLCAgY291bnQ6IDR9LFxuICAnVic6IHtwb2ludHM6IDQsICBjb3VudDogMn0sXG4gICdXJzoge3BvaW50czogNCwgIGNvdW50OiAyfSxcbiAgJ1gnOiB7cG9pbnRzOiA4LCAgY291bnQ6IDF9LFxuICAnWSc6IHtwb2ludHM6IDQsICBjb3VudDogMn0sXG4gICdaJzoge3BvaW50czogMTAsIGNvdW50OiAxfSxcbiAgJ18nOiB7cG9pbnRzOiAwLCAgY291bnQ6IDJ9LFxufTtcblxuY29uc3QgTEVUVEVSX0tFWVM6IFJlYWRvbmx5PExldHRlcltdPiA9IE9iamVjdC5rZXlzKExFVFRFUlMpIGFzIExldHRlcltdO1xuXG5mdW5jdGlvbiBzaHVmZmxlPFQ+KGFycjogVFtdKTogVFtdIHtcbiAgZm9yIChsZXQgaSA9IGFyci5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgY29uc3QgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpO1xuICAgIFthcnJbaV0sIGFycltqXV0gPSBbYXJyW2pdLCBhcnJbaV1dO1xuICB9XG4gIHJldHVybiBhcnI7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUZpcnN0PFQ+KGFycjogVFtdLCBlOiBUKTogVFtdIHtcbiAgY29uc3QgaSA9IGFyci5pbmRleE9mKGUpO1xuICBpZiAoaSA+IC0xKSB7XG4gICAgYXJyLnNwbGljZShpLCAxKTtcbiAgfVxuICByZXR1cm4gYXJyO1xufVxuXG5mdW5jdGlvbiBzZWFyY2g8VD4oXG4gIGFycjogVFtdLFxuICBzdGFydDogbnVtYmVyLFxuICBlbmRNYXg6IG51bWJlcixcbiAgbGVmdFByZWRpY2F0ZTogKGU6IFQsIGk6IG51bWJlcikgPT4gYm9vbGVhbixcbiAgcmlnaHRQcmVkaWNhdGU6IChlOiBULCBpOiBudW1iZXIpID0+IGJvb2xlYW4sXG4pOiB2b2lkIHtcbiAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpID49IDA7IGktLSkge1xuICAgIGlmICghbGVmdFByZWRpY2F0ZShhcnJbaV0sIGkpKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgZm9yIChsZXQgaSA9IHN0YXJ0ICsgMTsgaSA8IGVuZE1heDsgaSsrKSB7XG4gICAgaWYgKCFyaWdodFByZWRpY2F0ZShhcnJbaV0sIGkpKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgQmFnIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsZXR0ZXJzOiBMZXR0ZXJbXSA9IHNodWZmbGUoT2JqZWN0LmVudHJpZXMoTEVUVEVSUylcbiAgICAucmVkdWNlKFxuICAgICAgKGJhZywgW2xldHRlciwgcHJvcHNdKSA9PlxuICAgICAgICBbLi4uYmFnLCAuLi5BcnJheShwcm9wcy5jb3VudCkuZmlsbChsZXR0ZXIpXSxcbiAgICAgIEFycmF5PExldHRlcj4oKSkpO1xuXG4gIGRyYXcobjogbnVtYmVyKTogTGV0dGVyW10ge1xuICAgIGNvbnNvbGUuYXNzZXJ0KG4gPj0gMCk7XG4gICAgcmV0dXJuIHRoaXMubGV0dGVycy5zcGxpY2UoMCwgbik7XG4gIH1cblxuICBnZXQgaXNFbXB0eSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5sZXR0ZXJzLmxlbmd0aCA9PT0gMDtcbiAgfVxuXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubGV0dGVycy5qb2luKCk7XG4gIH1cbn1cblxuY2xhc3MgVGlsZSB7XG4gIGxldHRlcjogTGV0dGVyIHwgdW5kZWZpbmVkO1xuXG4gIGdldCBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmxldHRlciA9PT0gdW5kZWZpbmVkO1xuICB9XG59XG5cbmNsYXNzIFRpbGVzIHtcbiAgcHJpdmF0ZSByZWFkb25seSB0aWxlczogVGlsZVtdW107XG5cbiAgY29uc3RydWN0b3IodGlsZXM/OiBUaWxlW11bXSkge1xuICAgIHRoaXMudGlsZXMgPSAodGlsZXMgIT09IHVuZGVmaW5lZClcbiAgICAgID8gdGlsZXNcbiAgICAgIDogQXJyYXkoQk9BUkRfU0laRSlcbiAgICAgICAgLmZpbGwodW5kZWZpbmVkKVxuICAgICAgICAubWFwKCgpID0+IEFycmF5KEJPQVJEX1NJWkUpXG4gICAgICAgICAgLmZpbGwodW5kZWZpbmVkKVxuICAgICAgICAgIC5tYXAoKCkgPT4gbmV3IFRpbGUoKSkpO1xuICB9XG5cbiAgZ2V0IHRyYW5zcG9zZWQoKTogVGlsZXMge1xuICAgIHJldHVybiBuZXcgVGlsZXModGhpcy50aWxlc1swXS5tYXAoKF8sIGNvbCkgPT5cbiAgICAgIHRoaXMudGlsZXMubWFwKHJvdyA9PiByb3dbY29sXSkpKTtcbiAgfVxuXG4gIGdldFJvdyhyb3c6IG51bWJlcik6IFRpbGVbXSB7XG4gICAgY29uc29sZS5hc3NlcnQocm93ID49IDApO1xuICAgIGNvbnNvbGUuYXNzZXJ0KHJvdyA8IEJPQVJEX1NJWkUpO1xuICAgIHJldHVybiB0aGlzLnRpbGVzW3Jvd107XG4gIH1cblxuICBnZXRDb2woY29sOiBudW1iZXIpOiBUaWxlW10ge1xuICAgIGNvbnNvbGUuYXNzZXJ0KGNvbCA+PSAwKTtcbiAgICBjb25zb2xlLmFzc2VydChjb2wgPCBCT0FSRF9TSVpFKTtcbiAgICByZXR1cm4gdGhpcy50aWxlcy5tYXAocm93ID0+IHJvd1tjb2xdKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgbGV0IHN0ciA9ICcgICc7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBCT0FSRF9TSVpFOyBpKyspIHtcbiAgICAgIHN0ciArPSBpLnRvU3RyaW5nKDE2KSArICcgJztcbiAgICB9XG4gICAgc3RyICs9ICdcXG4nO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgQk9BUkRfU0laRTsgaSsrKSB7XG4gICAgICBjb25zdCByb3cgPSB0aGlzLnRpbGVzW2ldO1xuICAgICAgc3RyICs9IGkudG9TdHJpbmcoMTYpICsgJyAnO1xuICAgICAgZm9yIChjb25zdCB0aWxlIG9mIHJvdykge1xuICAgICAgICBzdHIgKz0gKHRpbGUubGV0dGVyIHx8ICctJykgKyAnICc7XG4gICAgICB9XG4gICAgICBzdHIgKz0gJ1xcbic7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG4gIH1cbn1cblxuY2xhc3MgQm9hcmQge1xuICBwcml2YXRlIHRpbGVzID0gbmV3IFRpbGVzKCk7XG5cbiAgcGxhY2Uocm93OiBudW1iZXIsIGNvbDogbnVtYmVyLCBsZXR0ZXJzOiBMZXR0ZXJbXSwgZGlyOiBEaXIpOiBudW1iZXIge1xuICAgIGNvbnN0IHRpbGVzID0gKGRpciA9PT0gRGlyLkRPV04pID8gdGhpcy50aWxlcy50cmFuc3Bvc2VkIDogdGhpcy50aWxlcztcbiAgICBpZiAoZGlyID09PSBEaXIuRE9XTikgW3JvdywgY29sXSA9IFtjb2wsIHJvd107XG4gICAgY29uc3Qgcm93VGlsZXMgPSB0aWxlcy5nZXRSb3cocm93KTtcblxuICAgIGxldCBwb2ludHMgPSAwO1xuICAgIGNvbnN0IGFkZFBvaW50c1VudGlsQmxhbmsgPSAodDogVGlsZSkgPT4ge1xuICAgICAgaWYgKHQuaXNFbXB0eSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBwb2ludHMgKz0gTEVUVEVSU1t0LmxldHRlciFdLnBvaW50cztcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgbGV0IGxldHRlcklkeCA9IDA7XG4gICAgc2VhcmNoKHJvd1RpbGVzLCBjb2wgLSAxLCBCT0FSRF9TSVpFLCBhZGRQb2ludHNVbnRpbEJsYW5rLFxuICAgICAgKHQsIGNvbCkgPT4ge1xuICAgICAgICBpZiAodC5pc0VtcHR5ICYmIGxldHRlcklkeCA9PT0gbGV0dGVycy5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGV0dGVyID0gbGV0dGVyc1tsZXR0ZXJJZHgrK107XG4gICAgICAgIGlmICh0LmlzRW1wdHkpIHtcbiAgICAgICAgICB0LmxldHRlciA9IGxldHRlcjtcbiAgICAgICAgICBzZWFyY2godGlsZXMuZ2V0Q29sKGNvbCksIHJvdywgQk9BUkRfU0laRSxcbiAgICAgICAgICAgIGFkZFBvaW50c1VudGlsQmxhbmssIGFkZFBvaW50c1VudGlsQmxhbmspO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBvaW50cyArPSBMRVRURVJTW3QubGV0dGVyIV0ucG9pbnRzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSk7XG4gICAgcmV0dXJuIHBvaW50cztcbiAgfVxuXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudGlsZXMudG9TdHJpbmcoKTtcbiAgfVxufVxuXG5jbGFzcyBTY3JhYmJsZSB7XG4gIHJlYWRvbmx5IGJhZyA9IG5ldyBCYWcoKTtcbiAgcmVhZG9ubHkgYm9hcmQgPSBuZXcgQm9hcmQoKTtcbiAgcmVhZG9ubHkgcGxheWVyczogUGxheWVyW107XG5cbiAgY29uc3RydWN0b3IoLi4ucGxheWVyczogUGxheWVyW10pIHtcbiAgICB0aGlzLnBsYXllcnMgPSBwbGF5ZXJzO1xuICAgIHBsYXllcnMuZm9yRWFjaChwbGF5ZXIgPT4gcGxheWVyLmRyYXdGcm9tKHRoaXMuYmFnKSk7XG4gIH1cblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmJvYXJkLnRvU3RyaW5nKCk7XG4gIH1cbn1cblxuY2xhc3MgUGxheWVyIHtcbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuXG4gIHByaXZhdGUgcG9pbnRzOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIHJhY2s6IExldHRlcltdID0gW107XG5cbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIGRyYXdGcm9tKGJhZzogQmFnKSB7XG4gICAgdGhpcy5yYWNrLnB1c2goLi4uYmFnLmRyYXcoTUFYX1JBQ0tfTEVOIC0gdGhpcy5yYWNrLmxlbmd0aCkpO1xuICB9XG5cbiAgcGxheShcbiAgICBnYW1lOiBTY3JhYmJsZSxcbiAgICByb3c6IG51bWJlcixcbiAgICBjb2w6IG51bWJlcixcbiAgICBsZXR0ZXJzOiBMZXR0ZXJbXSxcbiAgICBkaXI6IERpcixcbiAgKTogdm9pZCB7XG4gICAgdGhpcy5wb2ludHMgKz0gZ2FtZS5ib2FyZC5wbGFjZShyb3csIGNvbCwgbGV0dGVycywgZGlyKTtcbiAgICBsZXR0ZXJzLmZvckVhY2gobGV0dGVyID0+IHJlbW92ZUZpcnN0KHRoaXMucmFjaywgbGV0dGVyKSk7XG4gICAgdGhpcy5kcmF3RnJvbShnYW1lLmJhZyk7XG4gIH1cblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHt0aGlzLm5hbWV9ICgke3RoaXMucG9pbnRzfSBwb2ludHMpICR7dGhpcy5yYWNrLmpvaW4oKX1gO1xuICB9XG59XG5cbmNvbnN0IHBsYXllcjEgPSBuZXcgUGxheWVyKCdUSicpO1xuY29uc3QgcGxheWVyMiA9IG5ldyBQbGF5ZXIoJ0p1c3RpbmUnKTtcbmNvbnN0IGdhbWUgPSBuZXcgU2NyYWJibGUocGxheWVyMSwgcGxheWVyMik7XG5cbmNvbnNvbGUubG9nKGdhbWUudG9TdHJpbmcoKSk7XG5jb25zb2xlLmxvZyhwbGF5ZXIxLnRvU3RyaW5nKCkpO1xuY29uc29sZS5sb2cocGxheWVyMi50b1N0cmluZygpKTtcblxuZnVuY3Rpb24gcGxheShcbiAgcGxheWVyOiBQbGF5ZXIsXG4gIHJvdzogbnVtYmVyLFxuICBjb2w6IG51bWJlcixcbiAgd29yZDogc3RyaW5nLFxuICBkaXI6IERpcixcbikge1xuICBjb25zdCBsZXR0ZXJzID0gWy4uLndvcmRdLm1hcChsZXR0ZXIgPT4gbGV0dGVyIGFzIExldHRlcik7XG4gIHBsYXllci5wbGF5KGdhbWUsIHJvdywgY29sLCBsZXR0ZXJzLCBkaXIpO1xuICBjb25zb2xlLmxvZyhnYW1lLnRvU3RyaW5nKCkpO1xuICBjb25zb2xlLmxvZyhwbGF5ZXIxLnRvU3RyaW5nKCkpO1xuICBjb25zb2xlLmxvZyhwbGF5ZXIyLnRvU3RyaW5nKCkpO1xufVxuXG4od2luZG93IGFzIGFueSkucGxheTEgPSBmdW5jdGlvbiAoXG4gIHJvdzogbnVtYmVyLFxuICBjb2w6IG51bWJlcixcbiAgd29yZDogc3RyaW5nLFxuICBkaXI6IERpcikge1xuICBwbGF5KHBsYXllcjEsIHJvdywgY29sLCB3b3JkLCBkaXIpO1xufTtcblxuKHdpbmRvdyBhcyBhbnkpLnBsYXkyID0gZnVuY3Rpb24gKFxuICByb3c6IG51bWJlcixcbiAgY29sOiBudW1iZXIsXG4gIHdvcmQ6IHN0cmluZyxcbiAgZGlyOiBEaXIsXG4pIHtcbiAgcGxheShwbGF5ZXIyLCByb3csIGNvbCwgd29yZCwgZGlyKTtcbn07XG4iXX0=